# sub-make for experiences
#
# usage:
#	include make_e
# define ROOT_PATH CCTX PRE_MACRO 
# befor make_e included.
#
# lxr, 2020.02

SRC_PATH=$(ROOT_PATH)/src
INCLUDE = -I$(ROOT_PATH)/include

-include $(SRC_PATH)/make_p
CC=gcc
CFLAGS += -Wall -g $(INCLUDE)

all: src_objs e_objs $(TARGET)

LN_PRE_MACRO=$(PRE_MACRO)
export LN_PRE_MACRO
SRC_OBJS=objs
src_objs:
	@make -C $(SRC_PATH) \
		CCTX=$(CCTX) OBJS=$(SRC_OBJS)

SRCS = $(wildcard ./*.c)
OBJS = ${patsubst %.c, %.o, $(SRCS)}
e_objs: $(OBJS)

%.o:%.c
	$(CC) $(CFLAGS) \
	-c $< -o $@
-include $(SRC_PATH)/make_d

$(TARGET):
	$(CC) $(CFLAGS) $(OBJS) \
		$(SRC_PATH)/$(SRC_OBJS)/*.o -o $@

clean:
	@make -C $(SRC_PATH) clean \
		CCTX=$(CCTX) OBJS=$(SRC_OBJS)
	-rm -f ./*.[do]* $(TARGET)
